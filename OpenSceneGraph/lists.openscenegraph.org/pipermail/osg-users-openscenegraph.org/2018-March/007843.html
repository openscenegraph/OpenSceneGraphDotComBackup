<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [osg-users] Qt OsgEarth HudCamera Composition
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:osg-users%40lists.openscenegraph.org?Subject=Re%3A%20%5Bosg-users%5D%20Qt%20OsgEarth%20HudCamera%20Composition&In-Reply-To=%3C1521196471.m2f.73108%40forum.openscenegraph.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <LINK REL="Previous"  HREF="007840.html">
   <LINK REL="Next"  HREF="007846.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[osg-users] Qt OsgEarth HudCamera Composition</H1>
<!--htdig_noindex-->
    <B>Ali Ozdin</B> 
    <A HREF="mailto:osg-users%40lists.openscenegraph.org?Subject=Re%3A%20%5Bosg-users%5D%20Qt%20OsgEarth%20HudCamera%20Composition&In-Reply-To=%3C1521196471.m2f.73108%40forum.openscenegraph.org%3E"
       TITLE="[osg-users] Qt OsgEarth HudCamera Composition">alinailozdin at gmail.com
       </A><BR>
    <I>Fri Mar 16 03:34:31 PDT 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="007840.html">[osg-users] [forum] How OpenSource make a profit
</A></li>
        <LI>Next message (by thread): <A HREF="007846.html">[osg-users] Preparing to tag the OpenSceneGraph-3.5.10 dev release
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7843">[ date ]</a>
              <a href="thread.html#7843">[ thread ]</a>
              <a href="subject.html#7843">[ subject ]</a>
              <a href="author.html#7843">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Hi,

I can not see hud camera text. I only see main camera output which is generated by osg Earth manipulator. This problem comes up with integration with Qt. Before integrating with Qt, this derived hud view example works great. I am sharing a sample of code. What is the reason that I could not see the text created with createText function. I think the problem is related to buffer bits again like in there <A HREF="http://forum.openscenegraph.org/viewtopic.php?t=17146">http://forum.openscenegraph.org/viewtopic.php?t=17146</A>

What should I do to solve this problem?

Best regards,


Code:




void ExampleWidget::addText(osg::ref_ptr&lt;osg::Geode&gt; geode)
{
osg::Vec3 position( 200.0f, 25.0f, 0.0f);
osgText::Text* text = new  osgText::Text;
std::string timesFont(&quot;fonts/arial.ttf&quot;);
text-&gt;setAlignment(osgText::TextBase::AlignmentType::LEFT_BOTTOM_BASE_LINE);
text-&gt;setFont(timesFont);
text-&gt;setPosition(position);
text-&gt;setText(&quot;HELLO WORLD !!!!!&quot;);
text-&gt;setCharacterSize(50.0);
geode-&gt;addDrawable( text );
}


osg::ref_ptr&lt;osg::Camera&gt; ExampleWidget::createHUD()
{
// create a camera to set up the projection and model view matrices, and the subgraph to draw in the HUD
osg::ref_ptr&lt;osg::Camera&gt; camera = new osg::Camera;

// set the projection matrix
camera-&gt;setProjectionMatrix(osg::Matrix::ortho2D(0,1280,0,1024));

// set the view matrix
camera-&gt;setReferenceFrame(osg::Transform::ABSOLUTE_RF);
camera-&gt;setViewMatrix(osg::Matrix::identity());

// only clear the depth buffer
camera-&gt;setClearMask(  GL_COLOR_BUFFER_BIT );
// draw subgraph after main camera view.
camera-&gt;setRenderOrder(osg::Camera::POST_RENDER);

// we don't want the camera to grab event focus from the viewers main camera(s).
camera-&gt;setAllowEventFocus(false);

camera-&gt;getOrCreateStateSet()-&gt;setAttributeAndModes( new osg::Depth( osg::Depth::LEQUAL, 0.0, 0.0) );

return camera.get();
}

ExampleWidget::ExampleWidget(QWidget* parent, Qt::WindowFlags f, osgViewer::ViewerBase::ThreadingModel threadingModel ) 
:<i> QWidget(parent, f)
</I>{
viewer = new osgViewer::Viewer;
setThreadingModel( threadingModel ) ;
setKeyEventSetsDone(0);

QWidget* widget1 = create();

QGridLayout* grid = new QGridLayout;	
grid-&gt;addWidget( widget1, 0, 0 );
setLayout( grid );

connect( &amp;_timer, SIGNAL(timeout()), this, SLOT(update()) );
_timer.start( 10 );
}

QWidget* ExampleWidget::create( )
{
osg::ArgumentParser arguments(&amp;argc,argv);
osg::ref_ptr&lt;osg::Group&gt; group = MapNodeHelper().load(arguments, viewer);//osg::ref_ptr&lt;osg::Node&gt; group = osgDB::readRefNodeFiles(arguments);
manipulator = new EarthManipulator(  /*arguments*/ );
viewer-&gt;setCameraManipulator( manipulator );

osgEarth::Config c;
c.add(&quot;srs&quot;,&quot;wgs84&quot;);
c.add(&quot;vdatum&quot;,&quot;egm96&quot;);
c.add( &quot;x&quot;, 39.0  );
c.add( &quot;y&quot;,  32.0);
c.add( &quot;z&quot;, 1300 );
//c.add( &quot;range&quot;, 0 );
c.add( &quot;heading&quot;, 0.0 );
c.add( &quot;pitch&quot;, -90.0 );		
Viewpoint v;
manipulator-&gt;zoom(0.0,0.0);
manipulator-&gt;setHomeViewpoint( Viewpoint(c) );

osg::ref_ptr&lt;osg::Camera&gt; hudCamera = createHUD();

osg::ref_ptr&lt;osg::Geode&gt; geode = new osg::Geode();
// turn lighting off for the text and disable depth test to ensure it's always ontop.
geode-&gt;getOrCreateStateSet()-&gt;setMode(GL_LIGHTING,osg::StateAttribute::OFF);

addText(geode);
hudCamera-&gt;addChild(geode);
hudCamera-&gt;setClearColor( osg::Vec4(255.0, 0.0, 0.0, 1.0) );

viewer-&gt;addEventHandler( new osgViewer::StatsHandler );

osgQt::GraphicsWindowQt* gw = createGraphicsWindow(0,0,500,500);
const osg::GraphicsContext::Traits* traits = gw-&gt;getTraits();
osg::Viewport* wp = new osg::Viewport( 0, 0, traits-&gt;width, traits-&gt;height );


hudCamera-&gt;setGraphicsContext( gw );
hudCamera-&gt;setViewport( wp );

viewer-&gt;getCamera()-&gt;setGraphicsContext( gw );
viewer-&gt;getCamera()-&gt;setViewport( wp );

group-&gt;setDataVariance(osg::Object::DataVariance::STATIC);
manipulator-&gt;setDataVariance( osg::Object::DataVariance::DYNAMIC );


osgUtil::Optimizer optimizer;
optimizer.optimize(group.get());

viewer-&gt;addSlave(hudCamera, false);
viewer-&gt;setSceneData(group);

addView( viewer );


return gw-&gt;getGLWidget();

}





------------------
Read this topic online here:
<A HREF="http://forum.openscenegraph.org/viewtopic.php?p=73108#73108">http://forum.openscenegraph.org/viewtopic.php?p=73108#73108</A>





</PRE>









<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="007840.html">[osg-users] [forum] How OpenSource make a profit
</A></li>
	<LI>Next message (by thread): <A HREF="007846.html">[osg-users] Preparing to tag the OpenSceneGraph-3.5.10 dev release
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7843">[ date ]</a>
              <a href="thread.html#7843">[ thread ]</a>
              <a href="subject.html#7843">[ subject ]</a>
              <a href="author.html#7843">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../listinfo.cgi/osg-users-openscenegraph.html">More information about the osg-users
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>

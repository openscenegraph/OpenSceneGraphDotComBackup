<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [osg-users] INVALID_OPERATION with compressed textures with mipmaps in OSG 3.4.0.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:osg-users%40lists.openscenegraph.org?Subject=Re%3A%20%5Bosg-users%5D%20INVALID_OPERATION%20with%20compressed%20textures%20with%0A%20mipmaps%20in%20OSG%203.4.0.&In-Reply-To=%3CCAFN7Y%2BVpAxL9Ls3FkHDUGEn4_u6OKM4VETOx-fDqPY7O7V%2Bq0g%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <LINK REL="Previous"  HREF="001586.html">
   <LINK REL="Next"  HREF="277806.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[osg-users] INVALID_OPERATION with compressed textures with mipmaps in OSG 3.4.0.</H1>
<!--htdig_noindex-->
    <B>Robert Osfield</B> 
    <A HREF="mailto:osg-users%40lists.openscenegraph.org?Subject=Re%3A%20%5Bosg-users%5D%20INVALID_OPERATION%20with%20compressed%20textures%20with%0A%20mipmaps%20in%20OSG%203.4.0.&In-Reply-To=%3CCAFN7Y%2BVpAxL9Ls3FkHDUGEn4_u6OKM4VETOx-fDqPY7O7V%2Bq0g%40mail.gmail.com%3E"
       TITLE="[osg-users] INVALID_OPERATION with compressed textures with mipmaps in OSG 3.4.0.">robert.osfield at gmail.com
       </A><BR>
    <I>Thu Sep 24 00:28:53 PDT 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="001586.html">[osg-users] INVALID_OPERATION with compressed textures with mipmaps in OSG 3.4.0.
</A></li>
        <LI>Next message: <A HREF="277806.html">[osg-users] OpenThread, each with its own viewer and performance
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1589">[ date ]</a>
              <a href="thread.html#1589">[ thread ]</a>
              <a href="subject.html#1589">[ subject ]</a>
              <a href="author.html#1589">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Hi Scott,

The problem under OSX looks to be a driver bug, there is small chance that
it's related to the problems you are seeing but likely a different issue.

The problem you describe sounds like a driver bug too, testing out without
other drivers/hardware/OS combinations would help with this.  Have you
tried any other combinations?

There is possibility that different drivers handle the input data in
different ways.  The addition of the glTextureStorage2D usage might be
adding another code pathway in the drivers that adds/removes/changes the
way that data is handled introducing the inconsistency that you are seeing.
The driver shouldn't be doing this, but no code is perfect.

Without an example model that can reproduce the problem there isn't much
others can do at this stage.  Potentially we could add a catch for
compressed textures + mipmap levels into osg::Texture*, but before any mods
to the core OSG I'd need to have a test example to work from that exhibits
a problem so that can confirm that these changes actually work.

Robert.

On 23 September 2015 at 22:24, Davis, Timothy S CTR comnavairsyscom &lt;
<A HREF="../../../listinfo.cgi/osg-users-openscenegraph.html">timothy.s.davis.ctr at navy.mil</A>&gt; wrote:

&gt;<i> Robert
</I>&gt;<i>
</I>&gt;<i> Sorry for the bad posting of my last message.  I'll repeat here and update
</I>&gt;<i> with new information.
</I>&gt;<i>
</I>&gt;<i> The code in question was added sometime during OSG 3.3.x development.  It
</I>&gt;<i> was not in OSG 3.2.1.  I just recently jumped from 3.2.1 to 3.4.0 for my
</I>&gt;<i> application which is when I ran into the problem.  It worked fine with OSG
</I>&gt;<i> 3.2.1.  In particular, it appears to be the added support for texture
</I>&gt;<i> storage objects and not specifically &quot;compressed texture support&quot;.  I noted
</I>&gt;<i> the call that gave the error was glCompressTexSubImage2D.  However I should
</I>&gt;<i> point out that I determined this using gDEBugger.  My version doesn't seem
</I>&gt;<i> to understand the texture storage extension.  So the error may have been
</I>&gt;<i> generated by the earlier call to setup the texture storage.  I checked into
</I>&gt;<i> this and indeed an INVALID_OPERATION was generated by the call to
</I>&gt;<i> glTexStorage2D.
</I>&gt;<i>
</I>&gt;<i> In addition, on my machine the problem doesn't affect all compressed
</I>&gt;<i> textures with mipmaps.  The model that first caused the problem had several
</I>&gt;<i> such textures, but only a small 32x32 texture resulted in a problem.  I
</I>&gt;<i> have no idea why this would be the case.  However I remember others
</I>&gt;<i> reporting issues with loading DDS textures and working around it by
</I>&gt;<i> commenting out the following line in ReaderWriterDDS:
</I>&gt;<i> If ( mipmap_offset.size()&gt;0) osgImage-&gt;setMipmapLevels(mipmap_offsets);
</I>&gt;<i> Commenting that line out would appear to disable mipmaps for compressed
</I>&gt;<i> textures and avoid the problems I've indicated.  This older problem was
</I>&gt;<i> reported only on OSX, but may be related.  This type of changed made to the
</I>&gt;<i> IVE loader would also have fixed my problem at the expense of disabling
</I>&gt;<i> mipmaps.
</I>&gt;<i>
</I>&gt;<i> Looking at a different model, the one problem texture was 128x128.  So
</I>&gt;<i> there appears to be nothing special about the size.  I did see that the
</I>&gt;<i> rendering result for the models that have the problem is different between
</I>&gt;<i> using the fixed-function pipeline and a shader.  With the FFP, the
</I>&gt;<i> rendering appears correct, though the INVALID_OPERATION error is
</I>&gt;<i> generated.  With a shader, the textures rendered black.
</I>&gt;<i>
</I>&gt;<i> I looked at making a simple model that would reproduce the problem.
</I>&gt;<i> However, I've failed to create such a model.  It just always works with no
</I>&gt;<i> render problems or OpenGL errors.
</I>&gt;<i>
</I>&gt;<i> For my application, I've worked around the problem by reducing the number
</I>&gt;<i> of mipmap levels to avoid using levels smaller than the compression block
</I>&gt;<i> size.  So I consider the problem fixed for me.  However, I feel this is
</I>&gt;<i> information that you and the rest of the community can use.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Scott
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> osg-users mailing list
</I>&gt;<i> <A HREF="../../../listinfo.cgi/osg-users-openscenegraph.html">osg-users at lists.openscenegraph.org</A>
</I>&gt;<i> <A HREF="../../../listinfo.cgi/osg-users-openscenegraph.html">http://lists.openscenegraph.org/listinfo.cgi/osg-users-openscenegraph.org</A>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="../attachments/20150924/00d45eb1/attachment-0003.html">http://lists.openscenegraph.org/pipermail/osg-users-openscenegraph.org/attachments/20150924/00d45eb1/attachment-0003.htm</A>&gt;
</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001586.html">[osg-users] INVALID_OPERATION with compressed textures with mipmaps in OSG 3.4.0.
</A></li>
	<LI>Next message: <A HREF="277806.html">[osg-users] OpenThread, each with its own viewer and performance
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1589">[ date ]</a>
              <a href="thread.html#1589">[ thread ]</a>
              <a href="subject.html#1589">[ subject ]</a>
              <a href="author.html#1589">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../listinfo.cgi/osg-users-openscenegraph.html">More information about the osg-users
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>

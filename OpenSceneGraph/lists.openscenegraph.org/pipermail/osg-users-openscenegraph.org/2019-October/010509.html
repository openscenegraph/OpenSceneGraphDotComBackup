<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [osg-users] Image from shader
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:osg-users%40lists.openscenegraph.org?Subject=Re%3A%20%5Bosg-users%5D%20Image%20from%20shader&In-Reply-To=%3C1570207324.m2f.76787%40forum.openscenegraph.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <LINK REL="Previous"  HREF="010507.html">
   <LINK REL="Next"  HREF="010511.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[osg-users] Image from shader</H1>
<!--htdig_noindex-->
    <B>Chris Djali</B> 
    <A HREF="mailto:osg-users%40lists.openscenegraph.org?Subject=Re%3A%20%5Bosg-users%5D%20Image%20from%20shader&In-Reply-To=%3C1570207324.m2f.76787%40forum.openscenegraph.org%3E"
       TITLE="[osg-users] Image from shader">krizdjali at gmail.com
       </A><BR>
    <I>Fri Oct  4 09:42:04 PDT 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="010507.html">[osg-users] Image from shader
</A></li>
        <LI>Next message (by thread): <A HREF="010511.html">[osg-users] Image from shader
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10509">[ date ]</a>
              <a href="thread.html#10509">[ thread ]</a>
              <a href="subject.html#10509">[ subject ]</a>
              <a href="author.html#10509">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Hi,

If you're not seeing any errors in the console, I don't think you've added your shader to the scene properly. You have to assign something to gl_Position otherwise the rasteriser has no idea where your vertex is, so doesn't know which pixels any triangles cover, and nothing will get drawn.

Also, I reckon two things that you've got wrong that stop you from getting image2 are:
	image2 looks like it has some basic lighting, hence why the cylinder's colour varies from left to right. You're not doing any lighting, just forwarding the vertex colour.

	image2 looks like it has a texture, at least on the brown bit. You're not sampling from a texture anywhere.



I'd start with these shaders generated by 3DLabs GLSL ShaderGen and comment out things or add things until you get the result you're after:

Vertex:

Code:

/*******************************************************
*  Fixed.vert Fixed Function Equivalent Vertex Shader  *
*        Automatically Generated by GLSL ShaderGen     *
*          <A HREF="https://github.com/mojocorp/ShaderGen">https://github.com/mojocorp/ShaderGen</A>       *
*******************************************************/
vec4 Ambient;
vec4 Diffuse;
vec4 Specular;


void pointLight(in int i, in vec3 normal, in vec3 eye, in vec3 ecPosition3)
{
   float nDotVP;       // normal . light direction
   float nDotHV;       // normal . light half vector
   float pf;           // power factor
   float attenuation;  // computed attenuation factor
   float d;            // distance from surface to light source
   vec3  VP;           // direction from surface to light position
   vec3  halfVector;   // direction of maximum highlights

   // Compute vector from surface to light position
   VP = vec3 (gl_LightSource[i].position) - ecPosition3;

   // Compute distance between surface and light position
   d = length(VP);

   // Normalize the vector from surface to light position
   VP = normalize(VP);

   // Compute attenuation
   attenuation = 1.0 / (gl_LightSource[i].constantAttenuation +
                        gl_LightSource[i].linearAttenuation * d +
                        gl_LightSource[i].quadraticAttenuation * d * d);

   halfVector = normalize(VP + eye);

   nDotVP = max(0.0, dot(normal, VP));
   nDotHV = max(0.0, dot(normal, halfVector));

   if (nDotVP == 0.0)
   {
       pf = 0.0;
   }
   else
   {
       pf = pow(nDotHV, gl_FrontMaterial.shininess);

   }
   Ambient  += gl_LightSource[i].ambient * attenuation;
   Diffuse  += gl_LightSource[i].diffuse * nDotVP * attenuation;
   Specular += gl_LightSource[i].specular * pf * attenuation;
}

vec3 fnormal(void)
{
    //Compute the normal 
    vec3 normal = gl_NormalMatrix * gl_Normal;
    normal = normalize(normal);
    return normal;
}

void ftexgen(in vec3 normal, in vec4 ecPosition)
{

    gl_TexCoord[0] = gl_MultiTexCoord0;
}

void flight(in vec3 normal, in vec4 ecPosition, float alphaFade)
{
    vec4 color;
    vec3 ecPosition3;
    vec3 eye;

    ecPosition3 = (vec3 (ecPosition)) / ecPosition.w;
    eye = vec3 (0.0, 0.0, 1.0);

    // Clear the light intensity accumulators
    Ambient  = vec4 (0.0);
    Diffuse  = vec4 (0.0);
    Specular = vec4 (0.0);

    pointLight(0, normal, eye, ecPosition3);

    color = gl_FrontLightModelProduct.sceneColor +
            Ambient  * gl_FrontMaterial.ambient +
            Diffuse  * gl_FrontMaterial.diffuse;
    color += Specular * gl_FrontMaterial.specular;
    color = clamp( color, 0.0, 1.0 );
    gl_FrontColor = color;

    gl_FrontColor.a *= alphaFade;
}


void main (void)
{
    vec3  transformedNormal;
    float alphaFade = 1.0;

    // Eye-coordinate position of vertex, needed in various calculations
    vec4 ecPosition = gl_ModelViewMatrix * gl_Vertex;

    // Do fixed functionality vertex transform
    gl_Position = gl_ProjectionMatrix * gl_ModelViewMatrix * gl_Vertex;
    transformedNormal = fnormal();
    flight(transformedNormal, ecPosition, alphaFade);
    ftexgen(transformedNormal, ecPosition);
}




Fragment:

Code:

/*******************************************************
* Fixed.frag Fixed Function Equivalent Fragment Shader *
*        Automatically Generated by GLSL ShaderGen     *
*          <A HREF="https://github.com/mojocorp/ShaderGen">https://github.com/mojocorp/ShaderGen</A>       *
*******************************************************/
uniform sampler2D texUnit0;

void main (void) 
{
    vec4 color;

    color = gl_Color;

    color *= texture2D(texUnit0, gl_TexCoord[0].xy);

    gl_FragColor = color;
}





Cheers,
Chris[/code]

------------------
Read this topic online here:
<A HREF="http://forum.openscenegraph.org/viewtopic.php?p=76787#76787">http://forum.openscenegraph.org/viewtopic.php?p=76787#76787</A>





</PRE>





<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="010507.html">[osg-users] Image from shader
</A></li>
	<LI>Next message (by thread): <A HREF="010511.html">[osg-users] Image from shader
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10509">[ date ]</a>
              <a href="thread.html#10509">[ thread ]</a>
              <a href="subject.html#10509">[ subject ]</a>
              <a href="author.html#10509">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../listinfo.cgi/osg-users-openscenegraph.html">More information about the osg-users
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>

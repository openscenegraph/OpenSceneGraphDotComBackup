<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [osg-users] Slow optimization and OpenFlight
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:osg-users%40lists.openscenegraph.org?Subject=Re%3A%20%5Bosg-users%5D%20Slow%20optimization%20and%20OpenFlight&In-Reply-To=%3CCAFN7Y%2BX3uaKmg9JQ6D5wRZbdkmegOsuNYge4VLsuvoM2W6d_Tw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007291.html">
   <LINK REL="Next"  HREF="007294.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[osg-users] Slow optimization and OpenFlight</H1>
<!--htdig_noindex-->
    <B>Robert Osfield</B> 
    <A HREF="mailto:osg-users%40lists.openscenegraph.org?Subject=Re%3A%20%5Bosg-users%5D%20Slow%20optimization%20and%20OpenFlight&In-Reply-To=%3CCAFN7Y%2BX3uaKmg9JQ6D5wRZbdkmegOsuNYge4VLsuvoM2W6d_Tw%40mail.gmail.com%3E"
       TITLE="[osg-users] Slow optimization and OpenFlight">robert.osfield at gmail.com
       </A><BR>
    <I>Mon Nov 27 05:27:26 PST 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="007291.html">[osg-users] Slow optimization and OpenFlight
</A></li>
        <LI>Next message (by thread): <A HREF="007294.html">[osg-users] Slow optimization and OpenFlight
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7292">[ date ]</a>
              <a href="thread.html#7292">[ thread ]</a>
              <a href="subject.html#7292">[ subject ]</a>
              <a href="author.html#7292">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>HI Andreas,

I gave up the valgrind tool=callgrind because it was taking too long
to complete.  What I did gleen from it was that the run confirms that
removeChildren() is a bottleneck.

To get some context to why it's a bottlenck I put in some stats output
from the MergeGeometryVisitor::mergeGroup(..) and got the following
output:

$ osgconv house_150k.flt test3.osgb
Optimizer::MergeGeometryVisitor::mergeGroup() 148976
    duplicateList.size()=3333
    duplicateList.size()=3333
    duplicateList.size()=3333
    duplicateList.size()=3333
    duplicateList.size()=3333
    duplicateList.size()=3333
    duplicateList.size()=3333
    duplicateList.size()=3333
    duplicateList.size()=3333
    duplicateList.size()=3333
    duplicateList.size()=3333
    duplicateList.size()=3333
    duplicateList.size()=3333
    duplicateList.size()=3333
    duplicateList.size()=3333
    duplicateList.size()=3333
    duplicateList.size()=3333
    duplicateList.size()=3333
    duplicateList.size()=3333
    duplicateList.size()=3333
    duplicateList.size()=3333
    duplicateList.size()=3333
    duplicateList.size()=3333
    duplicateList.size()=3333
    duplicateList.size()=3333
    duplicateList.size()=3333
    duplicateList.size()=3333
    duplicateList.size()=3333
    duplicateList.size()=3333
    duplicateList.size()=3333
    duplicateList.size()=3333
    duplicateList.size()=3333
    duplicateList.size()=3333
    duplicateList.size()=3333
    duplicateList.size()=3333
    duplicateList.size()=3333
    duplicateList.size()=3333
    duplicateList.size()=3333
    duplicateList.size()=3333
    duplicateList.size()=3333
    duplicateList.size()=3333
    duplicateList.size()=3333
    duplicateList.size()=3333
    duplicateList.size()=3333
    duplicateList.size()=2324
Data written to 'test3.osgb'.

What this tells us that this dataset generated by the OpenFlight
loader is truly dreadful.  It's just appalling how it's handling the
house_150k.flt database.  I don't know if this can be traced back to
what the OSG's OpenFlight plugin is doing or whether the tool that
generated the .flt file is just has a completely awful export tool.
What I can say is that the fact that the OSG can handle at all such a
brain dead messed up dataset is a miracle.

The best way to resolve this issue is to refactor the
MergeGeometryVisitor so it handles these really bad datasets with more
grace, avoiding the pitfalls of an O(N^2) algorithm.

Having the core OSG &quot;fix&quot; really bad data is not a proper resolution.
it doesn't fix the fact the the OpenFlight loader is generating such a
dreadful scene graph.  It might be that the OpenFlight loader is just
doing what the source database is tell it to do and isn't to blame,
but like the change MergeGeometryVisitor, it may be worth catching
this dreadful datacase on load and never generating the broken scene
graph.  It's better to fix problems like this early rather than let it
get all the way to the osgUtil::Optimizer to patch fix things up, the
early it is done the less memory will be used and less memory will be
fragmented and better the performance will be.

I am afraid I just don't have the time to go chasing fixes to awful
3rd party data, I already have enough core OSG issues to do that
unpaid without taking on more.  I will resolve the
MergeGeometryVisitor O(N^2) issue but improving the OpenFlight loader
to handle dreadful 3rd party data better I'll have to defer to the
community.

Cheers,
Robert.
</PRE>


<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="007291.html">[osg-users] Slow optimization and OpenFlight
</A></li>
	<LI>Next message (by thread): <A HREF="007294.html">[osg-users] Slow optimization and OpenFlight
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7292">[ date ]</a>
              <a href="thread.html#7292">[ thread ]</a>
              <a href="subject.html#7292">[ subject ]</a>
              <a href="author.html#7292">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../listinfo.cgi/osg-users-openscenegraph.html">More information about the osg-users
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>

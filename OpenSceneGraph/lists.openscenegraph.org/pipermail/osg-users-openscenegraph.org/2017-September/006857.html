<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [osg-users] Post Processing Effect - Vertex Shader not working
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:osg-users%40lists.openscenegraph.org?Subject=Re%3A%20%5Bosg-users%5D%20Post%20Processing%20Effect%20-%20Vertex%20Shader%20not%20working&In-Reply-To=%3C162120A190C6CC4981767016BCB5FFF0021C98ABAC%40mgandexch01.exchange.meggitt.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <LINK REL="Previous"  HREF="006853.html">
   <LINK REL="Next"  HREF="006859.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[osg-users] Post Processing Effect - Vertex Shader not working</H1>
<!--htdig_noindex-->
    <B>Volckaert, Guy (CA - MTS)</B> 
    <A HREF="mailto:osg-users%40lists.openscenegraph.org?Subject=Re%3A%20%5Bosg-users%5D%20Post%20Processing%20Effect%20-%20Vertex%20Shader%20not%20working&In-Reply-To=%3C162120A190C6CC4981767016BCB5FFF0021C98ABAC%40mgandexch01.exchange.meggitt.net%3E"
       TITLE="[osg-users] Post Processing Effect - Vertex Shader not working">Guy.Volckaert at meggitt.com
       </A><BR>
    <I>Fri Sep 15 15:35:51 PDT 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="006853.html">[osg-users] Raytraced shader code
</A></li>
        <LI>Next message (by thread): <A HREF="006859.html">[osg-users] Post Processing Effect - Vertex Shader not working
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6857">[ date ]</a>
              <a href="thread.html#6857">[ thread ]</a>
              <a href="subject.html#6857">[ subject ]</a>
              <a href="author.html#6857">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Hi,

Sorry to bother you guys... but I was wondering if you can help identify why my pass through vertex shader isn't working. In essence, if I enable the vertex shader, then the scene disappears (I only see that blue background color). If I disable it then the scene appears correctly. No errors are generated by OSG after linking the vertex shader. I know that my fragment shader is working because if I set the gl_FragColor to red then the scene is completely red.

Here are my pass-thru shaders:

[code]
VERTEX SHADER
=============
attribute vec4 osg_Vertex;
void main( void )
{
     gl_Position = osg_Vertex;
}

FRAGMENT SHADER
===============
uniform sampler2D tRttTexture;

void main( void )
{
     vec3 vColor = texture2D( tRttTexture, gl_TexCoord[0].st ).rgb;
     // Output color.
     gl_FragColor = vec4( vColor, 1.0 );
}
[/code]


The shader is applied on a fullscreen quad using typical Ortho2D projection. Here is the code that loads the shader which is applied to the post process geode containing a single geometry quad:

[code]
void loadShaders( )
{
    osg::StateSet* pStateSet = g_pPolyGeode-&gt;getOrCreateStateSet( );

    osg::ref_ptr&lt;osg::Program&gt; pProgram = new osg::Program;
    pProgram-&gt;setName( &quot;PostProcessProgram&quot; );

    osg::ref_ptr&lt;osg::Shader&gt; pVertShader = osg::Shader::readShaderFile( osg::Shader::VERTEX, osgDB::findDataFile( &quot;shaders/osgprerender.vert&quot; ) );
    if( pVertShader )
    {
        pVertShader-&gt;setName( &quot;osgprerender.vert&quot; );
        pProgram-&gt;addShader( pVertShader );
        pProgram-&gt;addBindAttribLocation( &quot;osg_Vertex&quot;, 0 );
    }

    osg::ref_ptr&lt;osg::Shader&gt; pFragShader = osg::Shader::readShaderFile( osg::Shader::FRAGMENT, osgDB::findDataFile( &quot;shaders/osgprerender.frag&quot; ) );
    if( pFragShader )
    {
        pFragShader-&gt;setName( &quot;osgprerender.frag&quot; );
        pProgram-&gt;addShader( pFragShader );
    }

    // RTT texture.
    pStateSet-&gt;addUniform( new osg::Uniform( &quot;tRttTexture&quot;, 0 ) );
    pStateSet-&gt;setAttributeAndModes( pProgram, osg::StateAttribute::ON );
}
[/code]


What am I doing wrong? I tried different variation of the shader but nothing works. Here are the variations that I tried:

[code]
VARIATION #1
===========
void main( void )
{
     gl_Position = gl_Vertex;
}

VARIATION #2
===========
void main( void )
{
     gl_Position = gl_ModelViewProjectionMatrix * gl_Vertex;
}

VARIATION #3
===========
attribute vec4 osg_Vertex;
void main( void )
{
     gl_Position = gl_ModelViewProjectionMatrix * osg_Vertex;
}

VARIATION #4
===========
void main( void )
{
     gl_Position = ftransform();
}
[/code]

Any help would be really appreciated... The full source code is attached.

Thank you!

Cheers,
Guy

Guy Volckaert, ing.
Snr Software Engineer

Meggitt Training Systems (Quebec) Inc.
Syst&#232;mes d'entra&#238;nement Meggitt (Qu&#233;bec) Inc.
6140 Henri Bourassa West
Montreal, Quebec, H4R 3A6
Canada

Tel: 1 (514) 339 9938 Ext 617
Fax: 1 (514) 339 2641
Cell: 1 (514) 928-5641
email: <A HREF="../../../listinfo.cgi/osg-users-openscenegraph.html">guy.volckaert at meggitt.com</A>&lt;mailto:<A HREF="../../../listinfo.cgi/osg-users-openscenegraph.html">brian.bakker at meggitt.com</A>&gt;
url; www.meggitt.com&lt;<A HREF="http://www.meggitt.com/">http://www.meggitt.com</A>&gt;
skype: guy.volckaert

Svp. Consid&#233;rez l'environnement avant d'imprimer
Please consider the environment before printing this e-mail.


________________________________


This e-mail may contain proprietary information and/or copyright material. This e-mail is intended for the use of the addressee only. Any unauthorized use may be unlawful. If you receive this e-mail by mistake, please advise the sender immediately by using the reply facility in your e-mail software.

Information contained in and/or attached to this document may be subject to export control regulations of the European Community, USA, or other countries. Each recipient of this document is responsible to ensure that usage and/or transfer of any information contained in this document complies with all relevant export control regulations. If you are in any doubt about the export control restrictions that apply to this information, please contact the sender immediately.

Be aware that Meggitt may monitor incoming and outgoing e-mails to ensure compliance with the Meggitt IT Use policy.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="../attachments/20170915/28bfd552/attachment.html">http://lists.openscenegraph.org/pipermail/osg-users-openscenegraph.org/attachments/20170915/28bfd552/attachment.htm</A>&gt;
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: osgprerender2.cpp
URL: &lt;<A HREF="../attachments/20170915/28bfd552/attachment.asc">http://lists.openscenegraph.org/pipermail/osg-users-openscenegraph.org/attachments/20170915/28bfd552/attachment.asc</A>&gt;
</PRE>











<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="006853.html">[osg-users] Raytraced shader code
</A></li>
	<LI>Next message (by thread): <A HREF="006859.html">[osg-users] Post Processing Effect - Vertex Shader not working
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6857">[ date ]</a>
              <a href="thread.html#6857">[ thread ]</a>
              <a href="subject.html#6857">[ subject ]</a>
              <a href="author.html#6857">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../listinfo.cgi/osg-users-openscenegraph.html">More information about the osg-users
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [osg-users] Problems implementing Cascaded Shadow Maps
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:osg-users%40lists.openscenegraph.org?Subject=Re%3A%20%5Bosg-users%5D%20Problems%20implementing%20Cascaded%20Shadow%20Maps&In-Reply-To=%3C1469522196.m2f.68207%40forum.openscenegraph.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <LINK REL="Previous"  HREF="003772.html">
   <LINK REL="Next"  HREF="279989.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[osg-users] Problems implementing Cascaded Shadow Maps</H1>
<!--htdig_noindex-->
    <B>Dima Trepnau</B> 
    <A HREF="mailto:osg-users%40lists.openscenegraph.org?Subject=Re%3A%20%5Bosg-users%5D%20Problems%20implementing%20Cascaded%20Shadow%20Maps&In-Reply-To=%3C1469522196.m2f.68207%40forum.openscenegraph.org%3E"
       TITLE="[osg-users] Problems implementing Cascaded Shadow Maps">dietrich.trepnau at st.ovgu.de
       </A><BR>
    <I>Tue Jul 26 01:36:36 PDT 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="003772.html">[osg-users] CompositeViewer and FBO
</A></li>
        <LI>Next message: <A HREF="279989.html">[osg-users] Looking for idea about predictive tile loading.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#279988">[ date ]</a>
              <a href="thread.html#279988">[ thread ]</a>
              <a href="subject.html#279988">[ subject ]</a>
              <a href="author.html#279988">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Hi all,

I'm currently trying to implement cascading shadow maps into an old (OSG 2.81) Simulation Project of another Student. I already managed to create the correct shadow maps, but it seems I have a few strange Problems with uploading the textures to the shaders and transforming the Vertices into shadow space.

1. Problem:
When I upload the shadow maps to the shaders I always end up with values clamped to [0,64]. I already tried different internal formats, Pixel formats and Pixel types.
I also seem to be unable to use uniform Arrays. 

2. Problem:
To transform a vertex into shadow projection space I just need to multiply it by the modelViewProjection Matrix of the &quot;sun&quot; and do the perspective division right? 

The shadow maps generated by this cams definitely look correct, however I get strange results if I try to use the projection matrix myself.

I use a uniform object to upload the modelViewProjection Matrix of the first sun to the shader by using

Code:

stateset-&gt;addUniform(new osg::Uniform(osg::Uniform::FLOAT_MAT4 , &quot;shadowMat1&quot;));
stateset-&gt;getUniform(&quot;shadowMat1&quot;)-&gt;set(sunView-&gt;getCamera()-&gt;getViewMatrix() * sunView-&gt;getCamera()-&gt;getProjectionMatrix()) 




First I tries to use the shaders to color the vertices differently for each frustum split, but everthing had the same color.  
I then used a vertex that clearly is inside the Clip space of the first sun to test it.
When I transform a vertex into the view space by using the view matrix, I get the expected result, but after then transforming the view space coordinates with the projection matrix I end up with values like (-1666, 280, -13, 1). I expected values between [-1,1] since it's an orthographic camera.

Does anyone know what could cause this Problems?

Thank you!

------------------
Read this topic online here:
<A HREF="http://forum.openscenegraph.org/viewtopic.php?p=68207#68207">http://forum.openscenegraph.org/viewtopic.php?p=68207#68207</A>






</PRE>

<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003772.html">[osg-users] CompositeViewer and FBO
</A></li>
	<LI>Next message: <A HREF="279989.html">[osg-users] Looking for idea about predictive tile loading.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#279988">[ date ]</a>
              <a href="thread.html#279988">[ thread ]</a>
              <a href="subject.html#279988">[ subject ]</a>
              <a href="author.html#279988">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../listinfo.cgi/osg-users-openscenegraph.html">More information about the osg-users
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>

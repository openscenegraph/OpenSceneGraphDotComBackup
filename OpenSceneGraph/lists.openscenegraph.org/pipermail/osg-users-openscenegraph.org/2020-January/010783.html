<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [osg-users] OpenSceneGraph-3.6.5 release candidate 2 tagged, please test
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:osg-users%40lists.openscenegraph.org?Subject=Re%3A%20%5Bosg-users%5D%20OpenSceneGraph-3.6.5%20release%20candidate%202%20tagged%2C%0A%20please%20test&In-Reply-To=%3Cmailman.67424.1580251192.7167.osg-users-openscenegraph.org%40lists.openscenegraph.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <LINK REL="Previous"  HREF="010782.html">
   <LINK REL="Next"  HREF="010790.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[osg-users] OpenSceneGraph-3.6.5 release candidate 2 tagged, please test</H1>
<!--htdig_noindex-->
    <B>OpenSceneGraph Users</B> 
    <A HREF="mailto:osg-users%40lists.openscenegraph.org?Subject=Re%3A%20%5Bosg-users%5D%20OpenSceneGraph-3.6.5%20release%20candidate%202%20tagged%2C%0A%20please%20test&In-Reply-To=%3Cmailman.67424.1580251192.7167.osg-users-openscenegraph.org%40lists.openscenegraph.org%3E"
       TITLE="[osg-users] OpenSceneGraph-3.6.5 release candidate 2 tagged, please test">osg-users at lists.openscenegraph.org
       </A><BR>
    <I>Tue Jan 28 14:39:48 PST 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="010782.html">[osg-users] OpenSceneGraph-3.6.5 release candidate 2 tagged, please test
</A></li>
        <LI>Next message (by thread): <A HREF="010790.html">[osg-users] OpenSceneGraph-3.6.5 release candidate 2 tagged, please test
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10783">[ date ]</a>
              <a href="thread.html#10783">[ thread ]</a>
              <a href="subject.html#10783">[ subject ]</a>
              <a href="author.html#10783">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--/htdig_noindex-->
<!--beginarticle-->
<PRE>Hello again.

The googlegroup has search options, here's what I get if I search for 
&gt;<i> OpenMW. it comes up with several threads with you contributing:
</I>&gt;<i>
</I>&gt;<i> <A HREF="https://groups.google.com/forum/#!searchin/osg-users/OpenMW%7Csort:date">https://groups.google.com/forum/#!searchin/osg-users/OpenMW%7Csort:date</A>
</I>&gt;<i>
</I>
I can find chunks of the right thread (this is some: 
<A HREF="https://groups.google.com/forum/#!searchin/osg-users/OpenMW|sort:date/osg-users/4lwB0MZdPqM/-ohFXtp-CQAJ">https://groups.google.com/forum/#!searchin/osg-users/OpenMW|sort:date/osg-users/4lwB0MZdPqM/-ohFXtp-CQAJ</A>) 
but some seems to be missing. For example, this newer chunk shows up as a 
separate thread: 
<A HREF="https://groups.google.com/forum/#!searchin/osg-users/anyoldname3|sort:date/osg-users/lbFxUItJ_qc/KEkYK_1dAgAJ.">https://groups.google.com/forum/#!searchin/osg-users/anyoldname3|sort:date/osg-users/lbFxUItJ_qc/KEkYK_1dAgAJ.</A> 
It's reasonably likely that that's the end of the thread.

I don't disappear completely, I just step back.
&gt;<i>
</I>
I'm aware of the reasoning and that it's not total. It still has a pretty 
big impact on how much OSG work you actually get done, so I feel my word 
choice isn't that extreme.

If you have things you feel would be suitable to merge with the 3.6 branch 
&gt;<i> please make them. I can't review and provide feedback.  To properly judge 
</I>&gt;<i> changes I do need to understand the motivation behind them, it may be that 
</I>&gt;<i> the changes are workaround issues that are based solved in other ways.
</I>&gt;<i>
</I>
<A HREF="https://groups.google.com/d/msg/osg-users/lbFxUItJ_qc/c54xoN8oAAAJ">https://groups.google.com/d/msg/osg-users/lbFxUItJ_qc/c54xoN8oAAAJ</A> has a 
diff that resolved my problem and I suggested went into 3.6. A few posts 
lower, there's what we both agreed was the source for a simple application 
that didn't work. You said you'd look into it in more detail later in the 
hope of finding other potential solutions. I can't do that for you. I put 
days into this and couldn't find any better solutions than the one I 
posted. That might have been because I didn't write OSG and am unaware of a 
nifty feature that will fix everything, because I'm not actually clever 
enough to conceive of the right approach, or because there's genuinely no 
other option. It's certainly not because I didn't do a thorough enough 
investigation.

When you say not seeing the crash, I we talking about a different issue to 
&gt;<i> what Fabian was referring to?  Is Fabian working on the same versions of 
</I>&gt;<i> OpenME and OSG as yourself?
</I>&gt;<i>
</I>
I was referring to the crash he was seeing with the profiler. It's still 
called *OpenMW* with one *O* and one *W*, by the way. My testing was with 
the 3.6 branch of OSG as of 9b41f260 and master branch OpenMW from a few 
weeks ago. I've also got minor local changes to adapt to the Julien 
Valentine occlusion query PR you merged recently. Nothing that touches 
anything relevant to Fabian's crash has been merged since then, so latest 
master branch OpenMW is a good analogue for what I'm using. I suspect 
Fabian isn't using the same OSG and OpenMW as me exactly, as he needs to 
either merge this <A HREF="https://github.com/OpenMW/openmw/pull/2676">https://github.com/OpenMW/openmw/pull/2676</A> (or something 
like it) or use an OSG revision from before this 
<A HREF="https://github.com/openscenegraph/OpenSceneGraph/pull/902">https://github.com/openscenegraph/OpenSceneGraph/pull/902</A> got merged.

The OSG falls back to using the DefaultFont when the requested font can't 
&gt;<i> be found, so any chance this might be happening?  Something like font files 
</I>&gt;<i> missing, case of the font being different - Windows isn't case sensitive so 
</I>&gt;<i> when you move to a case sensitive OS you can see issues if there are errors 
</I>&gt;<i> in the filename.
</I>&gt;<i>
</I>
I've checked, and we switched to using a bundled TTF font in the middle of 
2018. Most development happens on Linux (and the person who switched the 
font over uses it exclusively) so the only way it wouldn't be finding the 
font would be if Fabian's doing something weird.

My build is using static osg, static osg-plugins and link time optimization.
&gt;<i>
</I>
For example, this could be the weird thing. We don't test statically linked 
OSG, although our semi-official Android port does things that way (it's not 
maintained by the core team, just one guy on his own, and it's got plenty 
of shortcomings). One possibility is that the Freetype plugin just got left 
out when building. Renaming the DLL so OpenMW couldn't see it did make it 
use the OSG default font in the profiler, but didn't allow me to reproduce 
Fabian's crash.



In summary:

   - Fabian has done something weird with either OSG or OpenMW that hasn't 
   been specified yet.
   - It's beginning to feel like you're misspelling OpenMW deliberately.
   - Regarding the as-yet unresolved default font/object cache not being 
   released issue I reported in March, the ball was left in your court with 
   nothing more I could do. Hopefully enough has been linked above that we can 
   move forward with that again if you've got more time now.
   - Without knowing what source code Fabian has built, I can't reproduce 
   or identify the issue he's seeing.

Cheers,

Chris





On Tuesday, 28 January 2020 11:51:31 UTC, OpenSceneGraph Users wrote:
&gt;<i>
</I>&gt;<i> Hi Fabian &amp; Chris,
</I>&gt;<i>
</I>&gt;<i> I was curious about the clean up of the global getGlobalReferencedMutex() 
</I>&gt;<i> so I added some debug messages to OpenThreads and to relevant calls in the 
</I>&gt;<i> OSG to track the creation and clean up of mutexes.  I tried an alternative 
</I>&gt;<i> means of static initialization of the static getGlobalReferencedMutex() and 
</I>&gt;<i> got the same behavior for before and after results so I don't think the 
</I>&gt;<i> version in the 3.6 branch is likley to be be a source of problem, even if 
</I>&gt;<i> it's not particular clean.  Below is diff of the changes I made.
</I>&gt;<i>
</I>&gt;<i> Robert
</I>&gt;<i>
</I>&gt;<i> $ git diff
</I>&gt;<i> diff --git a/src/OpenThreads/pthreads/PThreadMutex.cpp 
</I>&gt;<i> b/src/OpenThreads/pthreads/PThreadMutex.cpp
</I>&gt;<i> index 3a3d1c338..d122fc67c 100644
</I>&gt;<i> --- a/src/OpenThreads/pthreads/PThreadMutex.cpp
</I>&gt;<i> +++ b/src/OpenThreads/pthreads/PThreadMutex.cpp
</I>&gt;<i> @@ -22,6 +22,8 @@
</I>&gt;<i>  #include &lt;OpenThreads/Mutex&gt;
</I>&gt;<i>  #include &quot;PThreadMutexPrivateData.h&quot;
</I>&gt;<i>  
</I>&gt;<i> +#include &lt;stdio.h&gt;
</I>&gt;<i> +
</I>&gt;<i>  using namespace OpenThreads;
</I>&gt;<i>  
</I>&gt;<i>
</I>&gt;<i>  //----------------------------------------------------------------------------
</I>&gt;<i> @@ -33,7 +35,7 @@ using namespace OpenThreads;
</I>&gt;<i>  Mutex::Mutex(MutexType type):
</I>&gt;<i>      _mutexType(type)
</I>&gt;<i>  {
</I>&gt;<i> -
</I>&gt;<i> +    printf(&quot;Mutex::Mutex(%d) %p\n&quot;, type, this);
</I>&gt;<i>      pthread_mutexattr_t mutex_attr;
</I>&gt;<i>      pthread_mutexattr_init( &amp;mutex_attr );
</I>&gt;<i>      
</I>&gt;<i> @@ -107,6 +109,8 @@ Mutex::Mutex(MutexType type):
</I>&gt;<i>  //
</I>&gt;<i>  Mutex::~Mutex() {
</I>&gt;<i>  
</I>&gt;<i> +    printf(&quot;Mutex::~Mutex() %p\n&quot;, this);
</I>&gt;<i> +
</I>&gt;<i>      PThreadMutexPrivateData *pd =
</I>&gt;<i>          static_cast&lt;PThreadMutexPrivateData*&gt;(_prvData);
</I>&gt;<i>  
</I>&gt;<i> diff --git a/src/osg/Referenced.cpp b/src/osg/Referenced.cpp
</I>&gt;<i> index 95b665c57..267bda310 100644
</I>&gt;<i> --- a/src/osg/Referenced.cpp
</I>&gt;<i> +++ b/src/osg/Referenced.cpp
</I>&gt;<i> @@ -79,11 +79,16 @@ struct ResetPointer
</I>&gt;<i>  };
</I>&gt;<i>  
</I>&gt;<i>  typedef ResetPointer&lt;DeleteHandler&gt; DeleteHandlerPointer;
</I>&gt;<i> +
</I>&gt;<i> +#if 1
</I>&gt;<i> +#include &lt;stdio.h&gt;
</I>&gt;<i> +
</I>&gt;<i>  typedef ResetPointer&lt;OpenThreads::Mutex&gt; GlobalMutexPointer;
</I>&gt;<i>  
</I>&gt;<i>  OpenThreads::Mutex* Referenced::getGlobalReferencedMutex()
</I>&gt;<i>  {
</I>&gt;<i>      static GlobalMutexPointer s_ReferencedGlobalMutext = new 
</I>&gt;<i> OpenThreads::Mutex;
</I>&gt;<i> +    printf(&quot;Referenced::getGlobalReferencedMutex() %p\n&quot;, 
</I>&gt;<i> (s_ReferencedGlobalMutext.get()));
</I>&gt;<i>      return s_ReferencedGlobalMutext.get();
</I>&gt;<i>  }
</I>&gt;<i>  
</I>&gt;<i> @@ -96,6 +101,17 @@ struct InitGlobalMutexes
</I>&gt;<i>      }
</I>&gt;<i>  };
</I>&gt;<i>  static InitGlobalMutexes s_initGlobalMutexes;
</I>&gt;<i> +#else
</I>&gt;<i> +
</I>&gt;<i> +#include &lt;stdio.h&gt;
</I>&gt;<i> +
</I>&gt;<i> +static OpenThreads::Mutex s_ReferencedGlobalMutex;
</I>&gt;<i> +OpenThreads::Mutex* Referenced::getGlobalReferencedMutex()
</I>&gt;<i> +{
</I>&gt;<i> +    printf(&quot;Referenced::getGlobalReferencedMutex() %p\n&quot;, 
</I>&gt;<i> (&amp;s_ReferencedGlobalMutex));
</I>&gt;<i> +    return &amp;s_ReferencedGlobalMutex;
</I>&gt;<i> +}
</I>&gt;<i> +#endif
</I>&gt;<i>  
</I>&gt;<i>  // static std::auto_ptr&lt;DeleteHandler&gt; s_deleteHandler(0);
</I>&gt;<i>  static DeleteHandlerPointer s_deleteHandler(0);
</I>&gt;<i> diff --git a/src/osg/StateAttribute.cpp b/src/osg/StateAttribute.cpp
</I>&gt;<i> index e239fb3aa..c7df40894 100644
</I>&gt;<i> --- a/src/osg/StateAttribute.cpp
</I>&gt;<i> +++ b/src/osg/StateAttribute.cpp
</I>&gt;<i> @@ -39,6 +39,8 @@ void StateAttribute::removeParent(osg::StateSet* object)
</I>&gt;<i>  
</I>&gt;<i>      ParentList::iterator pitr = 
</I>&gt;<i> std::find(_parents.begin(),_parents.end(),object);
</I>&gt;<i>      if (pitr!=_parents.end()) _parents.erase(pitr);
</I>&gt;<i> +
</I>&gt;<i> +    printf(&quot;StateAttribute::removeParent()\n&quot;);
</I>&gt;<i>  }
</I>&gt;<i>  
</I>&gt;<i>  
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>
-- 
You received this message because you are subscribed to the Google Groups &quot;OpenSceneGraph Users&quot; group.
To unsubscribe from this group and stop receiving emails from it, send an email to <A HREF="../../../listinfo.cgi/osg-users-openscenegraph.html">osg-users+unsubscribe at googlegroups.com.</A>
To view this discussion on the web visit <A HREF="https://groups.google.com/d/msgid/osg-users/5170457d-c81d-4a7b-8ad2-27f8cface71c%40googlegroups.com.">https://groups.google.com/d/msgid/osg-users/5170457d-c81d-4a7b-8ad2-27f8cface71c%40googlegroups.com.</A>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="../attachments/20200128/e80d4424/attachment.html">http://lists.openscenegraph.org/pipermail/osg-users-openscenegraph.org/attachments/20200128/e80d4424/attachment.html</A>&gt;
</PRE>








<!--endarticle-->
<!--htdig_noindex-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="010782.html">[osg-users] OpenSceneGraph-3.6.5 release candidate 2 tagged, please test
</A></li>
	<LI>Next message (by thread): <A HREF="010790.html">[osg-users] OpenSceneGraph-3.6.5 release candidate 2 tagged, please test
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10783">[ date ]</a>
              <a href="thread.html#10783">[ thread ]</a>
              <a href="subject.html#10783">[ subject ]</a>
              <a href="author.html#10783">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../listinfo.cgi/osg-users-openscenegraph.html">More information about the osg-users
mailing list</a><br>
<!--/htdig_noindex-->
</body></html>
